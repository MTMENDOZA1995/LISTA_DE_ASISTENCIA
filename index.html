<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INICIAR SESIÓN - ECO FRAME MAX</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="login-card">
    <div class="card-header">
      <h1>REGISTRO DE ASISTENCIAS</h1>
    </div>
    <div class="card-body">
      <div class="logo-box">
        <img src="Imagenes/ECFM.png" alt="LOGO DE LA EMPRESA" />
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="usuario">USUARIO:</label>
          <input type="text" id="usuario" placeholder="INGRESE SU USUARIO" required oninput="this.value = this.value.toUpperCase()" />
        </div>

        <div class="form-group">
          <label for="contrasena">CONTRASEÑA:</label>
          <input type="password" id="contrasena" placeholder="INGRESE SU CONTRASEÑA" required oninput="this.value = this.value.toUpperCase()" />
        </div>

        <button type="submit">INICIAR SESIÓN</button>
      </form>
    </div>
    <div class="card-footer">
      ECO FRAME MAX
    </div>
  </div>
</body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("loginForm");

    if (!form) return;

    // Crear usuario predeterminado si no hay usuarios registrados
    const usuariosGuardados = JSON.parse(localStorage.getItem("usuarios")) || [];

    if (usuariosGuardados.length === 0) {
      const usuarioInicial = {
        codigo: "116224516",
        dni: "73372032",
        apellidos: "MENDOZA ACUÑA",
        nombres: "MAX TAYSON",
        cargo: "GERENTE",
        id: "MTMENDOZA",
        clave: "C8KM1Y0F1I3K1S6H",
      };
      localStorage.setItem("usuarios", JSON.stringify([usuarioInicial]));
      console.log("Usuario inicial creado: MTMENDOZA / C8KM1Y0F1I3K1S6H");
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const usuario    = document.getElementById("usuario").value.trim().toUpperCase();
      const contrasena = document.getElementById("contrasena").value.trim();
      const usuarios   = JSON.parse(localStorage.getItem("usuarios")) || [];

      const usuarioEncontrado = usuarios.find(u =>
        u.id.toUpperCase() === usuario && u.clave === contrasena
      );

      if (!usuarioEncontrado) {
        alert("USUARIO O CONTRASEÑA INCORRECTOS.");
        return;
      }

      // ✅ ACTIVAR LA SESIÓN
      sessionStorage.setItem("sesionActiva", "true");

      alert(`¡BIENVENIDO, ${usuarioEncontrado.nombres.toUpperCase()}!`);

      const cargo = usuarioEncontrado.cargo.trim().toLowerCase();

      switch (cargo) {
        case "gerente":
          window.location.href = "Botones.html";
          break;
        case "supervisor":
        case "administrador":
        case "asistente":
          window.location.href = "BotonesADM.html";
          break;
        default:
          window.location.href = "BotonesInv.html";
          break;
      }
    });
  });
</script>


</body>
</html>
